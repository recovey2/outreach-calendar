<!DOCTYPE html>
<html>
  <head>
    <title>Library Outreach Events</title>
    <meta charset="UTF-8" />
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      #calendar {
        max-width: 900px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <h1>Library Outreach Events</h1>
    <div id='calendar'></div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const calendarEl = document.getElementById('calendar');

        fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQvbKTHyiMY3-AH_C_izdf_VS0Y5ehl6mFRHGYcBYmmPnOpiykKdLhjdaCjO-1zZ302eF6j9U3fq2Hs/pub?gid=1476389767&single=true&output=csv')
          .then(response => response.text())
          .then(csvText => {
            const rows = csvText.split('\n').slice(1);
            const events = rows.map(row => {
              const columns = row.split(',');
              const [date, time, title, address, libStaff, circStaff, notes, signUp] = columns;

              if (!date || !title) return null;

              const staffNeeded = (parseInt(libStaff) || 0) + (parseInt(circStaff) || 0);

              return {
                title: title.trim(),
                start: new Date(date),
                extendedProps: {
                  time: time?.trim(),
                  address: address?.trim(),
                  libStaff: libStaff?.trim(),
                  circStaff: circStaff?.trim(),
                  notes: notes?.trim(),
                  signUp: signUp?.trim(),
                  staffNeeded
                }
              };
            }).filter(e => e !== null);

            const calendar = new FullCalendar.Calendar(calendarEl, {
              initialView: 'dayGridMonth',
              events,
              eventClick: function (info) {
                const props = info.event.extendedProps;
                const details = `
                  <strong>Time:</strong> ${props.time || 'N/A'}<br>
                  <strong>Location:</strong> ${props.address || 'N/A'}<br>
                  <strong>Library Staff Needed:</strong> ${props.libStaff || '0'}<br>
                  <strong>Circulation Staff Needed:</strong> ${props.circStaff || '0'}<br>
                  <strong>Total Staff Needed:</strong> ${props.staffNeeded}<br>
                  <strong>Notes:</strong> ${props.notes || 'None'}<br>
                  ${props.signUp ? `<strong><a href="${props.signUp}" target="_blank">Sign up here</a></strong>` : ''}
                `;
                const popup = document.createElement('div');
                popup.innerHTML = details;
                popup.style.padding = '10px';
                popup.style.background = 'white';
                popup.style.border = '1px solid #ccc';
                popup.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
                popup.style.position = 'fixed';
                popup.style.top = '20%';
                popup.style.left = '50%';
                popup.style.transform = 'translate(-50%, -20%)';
                popup.style.zIndex = 9999;

                const closeBtn = document.createElement('button');
                closeBtn.innerText = 'Close';
                closeBtn.onclick = () => document.body.removeChild(popup);
                closeBtn.style.marginTop = '10px';
                popup.appendChild(document.createElement('br'));
                popup.appendChild(closeBtn);

                document.body.appendChild(popup);
              }
            });

            calendar.render();
          });
      });
    </script>
  </body>
</html>
